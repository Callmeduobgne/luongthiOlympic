# IBN Backend Environment Configuration
# Copy this file to .env and update values

# ======================
# Environment
# ======================
ENV=production

# ======================
# Server Configuration
# ======================
SERVER_HOST=0.0.0.0
SERVER_PORT=8080

# ======================
# Database Configuration
# ======================
# Use service name in Docker network (production) or localhost (development)
DB_HOST=ibn-postgres
DB_PORT=5432
DB_USER=gateway
DB_PASSWORD=changeme
DB_NAME=ibn_gateway
DB_SSLMODE=disable
DB_MIN_CONNS=5
DB_MAX_CONNS=25
DB_IDLE_TIMEOUT=5m
DB_MAX_LIFETIME=1h

# ======================
# Redis Configuration
# ======================
# Use service name in Docker network (production) or localhost (development)
REDIS_HOST=ibn-redis
REDIS_PORT=6379
REDIS_PASSWORD=changeme
REDIS_DB=0

# ======================
# Hyperledger Fabric Configuration
# ======================
FABRIC_MSP_ID=Org1MSP
FABRIC_CRYPTO_PATH=../core/organizations
FABRIC_KEY_PATH=
FABRIC_TLS_CERT_PATH=
# Use peer's service name in Docker network
FABRIC_PEER_ENDPOINT=peer0.org1.ibn.vn:7051
FABRIC_GATEWAY_PEER=peer0.org1.ibn.vn
FABRIC_CHANNEL_NAME=ibnchannel

# ======================
# JWT Configuration (Legacy - for backward compatibility)
# ======================
JWT_SECRET=ibn-network-secret-production-2024-CHANGE-THIS
JWT_ISSUER=ibn-network
JWT_ACCESS_TTL=15m
JWT_REFRESH_TTL=168h

# ======================
# Rate Limiting
# ======================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS=1000
RATE_LIMIT_BURST=50

# ======================
# Circuit Breaker
# ======================
CB_MAX_REQUESTS=3
CB_INTERVAL=10s
CB_TIMEOUT=60s
CB_FAILURE_RATIO=0.6

# ======================
# Logging
# ======================
LOG_LEVEL=info
LOG_FORMAT=json

# ======================
# API Gateway Configuration (REQUIRED)
# ======================
# NOTE: Backend MUST use Gateway for all blockchain operations
# Direct Fabric connection is NOT allowed for security reasons
GATEWAY_ENABLED=true
GATEWAY_BASE_URL=http://api-gateway-nginx:80
GATEWAY_API_KEY=
GATEWAY_TIMEOUT=30s

# ======================
# OpenTelemetry (Optional)
# ======================
OTEL_ENABLED=false
OTEL_EXPORTER_OTLP_ENDPOINT=localhost:4317
OTEL_SERVICE_NAME=ibn-backend

# ======================
# Encryption Configuration (REQUIRED for certificate management)
# ======================
# Master key for encrypting user private keys (MUST be at least 32 characters)
# Generate with: openssl rand -base64 32
# IMPORTANT: Keep this secret secure! Use environment variables or secret management service
ENCRYPTION_MASTER_KEY=
