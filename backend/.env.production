# Production Environment Configuration for Hyperledger Fabric
# Copy this file to backend/.env for production deployment

# ============================================
# SERVER CONFIGURATION
# ============================================
SERVER_HOST=0.0.0.0
SERVER_PORT=8080
ENV=production

# ============================================
# HYPERLEDGER FABRIC CONFIGURATION
# ============================================

# MSP Configuration
FABRIC_MSP_ID=Org1MSP
FABRIC_CRYPTO_PATH=/opt/fabric/organizations
FABRIC_CHANNEL_NAME=ibnchannel

# Peer Configuration
FABRIC_PEER_ENDPOINT=peer0.org1.ibn.vn:7051
FABRIC_GATEWAY_PEER=peer0.org1.ibn.vn

# Certificate Paths (Auto-discovery enabled)
# If not specified, will auto-detect from crypto-config
# FABRIC_CERT_PATH=/opt/fabric/organizations/peerOrganizations/org1.ibn.vn/users/Admin@org1.ibn.vn/msp/signcerts/cert.pem
# FABRIC_KEY_PATH=/opt/fabric/organizations/peerOrganizations/org1.ibn.vn/users/Admin@org1.ibn.vn/msp/keystore/priv_sk
# FABRIC_TLS_CERT_PATH=/opt/fabric/organizations/peerOrganizations/org1.ibn.vn/peers/peer0.org1.ibn.vn/tls/ca.crt

# TLS Configuration
PEER_TLS_ENABLED=true
ORDERER_TLS_ENABLED=true

# ============================================
# GRPC CONFIGURATION (Production Optimized)
# ============================================
GRPC_MAX_RECEIVE_MESSAGE_LENGTH=104857600  # 100MB
GRPC_MAX_SEND_MESSAGE_LENGTH=104857600     # 100MB
GRPC_KEEPALIVE_TIME_MS=120000              # 2 minutes
GRPC_KEEPALIVE_TIMEOUT_MS=20000            # 20 seconds
GRPC_KEEPALIVE_PERMIT_WITHOUT_CALLS=true
GRPC_HTTP2_MIN_TIME_BETWEEN_PINGS_MS=120000
GRPC_HTTP2_MAX_PINGS_WITHOUT_DATA=0

# ============================================
# WEBSOCKET CONFIGURATION
# ============================================
WS_RECONNECT_INTERVAL=5000          # 5 seconds
WS_MAX_RETRIES=5
WS_PING_INTERVAL=30000              # 30 seconds
WS_PONG_TIMEOUT=60000               # 60 seconds
WS_MAX_MESSAGE_SIZE=524288          # 512KB
WS_UPDATE_INTERVAL=10000            # 10 seconds (production)

# WebSocket CORS (Production)
WS_ALLOWED_ORIGINS=https://dashboard.ibn.vn,https://app.ibn.vn
WS_ENABLE_COMPRESSION=true

# ============================================
# DATABASE CONFIGURATION
# ============================================
DB_HOST=postgres
DB_PORT=5432
DB_USER=ibn_user
DB_PASSWORD=CHANGE_THIS_IN_PRODUCTION
DB_NAME=ibn_network
DB_SSLMODE=require
DB_MIN_CONNS=10
DB_MAX_CONNS=50
DB_IDLE_TIMEOUT=5m
DB_MAX_LIFETIME=1h

# ============================================
# REDIS CONFIGURATION
# ============================================
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=CHANGE_THIS_IN_PRODUCTION
REDIS_DB=0
REDIS_MAX_RETRIES=3
REDIS_POOL_SIZE=20

# ============================================
# JWT CONFIGURATION
# ============================================
JWT_SECRET=CHANGE_THIS_TO_STRONG_SECRET_AT_LEAST_32_CHARS
JWT_ISSUER=ibn-network
JWT_ACCESS_TTL=15m
JWT_REFRESH_TTL=168h  # 7 days

# ============================================
# AUTHENTICATION & AUTHORIZATION
# ============================================
# Admin credentials (change in production)
ADMIN_USER=admin
ADMIN_PASSWORD=CHANGE_THIS_STRONG_PASSWORD

# OPA Policy Engine
OPA_ENABLED=true
OPA_BASE_URL=http://opa:8181

# ============================================
# RATE LIMITING
# ============================================
RATE_LIMIT_ENABLED=true
RATE_LIMIT_REQUESTS=1000    # requests per hour
RATE_LIMIT_BURST=50

# ============================================
# CORS CONFIGURATION
# ============================================
CORS_ALLOWED_ORIGINS=https://dashboard.ibn.vn,https://app.ibn.vn
CORS_ALLOWED_METHODS=GET,POST,PUT,PATCH,DELETE,OPTIONS
CORS_ALLOWED_HEADERS=Accept,Authorization,Content-Type,X-API-Key,Idempotency-Key
CORS_MAX_AGE=300

# ============================================
# CIRCUIT BREAKER
# ============================================
CB_MAX_REQUESTS=3
CB_INTERVAL=10s
CB_TIMEOUT=60s
CB_FAILURE_RATIO=0.6

# ============================================
# LOGGING CONFIGURATION
# ============================================
LOG_LEVEL=info
LOG_FORMAT=json

# Loki (Optional)
LOKI_BASE_URL=http://loki:3100

# ============================================
# MONITORING & OBSERVABILITY
# ============================================
# OpenTelemetry
OTEL_ENABLED=true
OTEL_ENDPOINT=http://otel-collector:4317
OTEL_SERVICE_NAME=ibn-backend

# Prometheus Metrics
METRICS_ENABLED=true
METRICS_PORT=9090

# ============================================
# ENCRYPTION
# ============================================
# Master key for encrypting sensitive data (MUST be at least 32 characters)
ENCRYPTION_MASTER_KEY=CHANGE_THIS_TO_RANDOM_32_PLUS_CHARS_KEY

# ============================================
# GATEWAY CONFIGURATION
# ============================================
GATEWAY_BASE_URL=http://api-gateway-nginx:80
GATEWAY_API_KEY=CHANGE_THIS_GATEWAY_API_KEY
GATEWAY_TIMEOUT=30s
GATEWAY_ENABLED=true

# ============================================
# ADMIN SERVICE CONFIGURATION
# ============================================
ADMIN_SERVICE_BASE_URL=http://admin-service:8090
ADMIN_SERVICE_API_KEY=CHANGE_THIS_ADMIN_API_KEY
ADMIN_SERVICE_TIMEOUT=60s
ADMIN_SERVICE_ENABLED=true

# ============================================
# FABRIC TIMEOUTS (Production Values)
# ============================================
FABRIC_EVALUATE_TIMEOUT=10s
FABRIC_ENDORSE_TIMEOUT=30s
FABRIC_SUBMIT_TIMEOUT=60s
FABRIC_COMMIT_STATUS_TIMEOUT=120s

# Connection Health Check
FABRIC_HEALTH_CHECK_INTERVAL=30s
FABRIC_CONNECTION_TIMEOUT=10s
FABRIC_RECONNECT_DELAY=5s
FABRIC_MAX_RECONNECT_ATTEMPTS=5

# ============================================
# NGINX (If using reverse proxy)
# ============================================
NGINX_UPSTREAM_BACKEND=backend:8080
NGINX_CLIENT_MAX_BODY_SIZE=100M
NGINX_PROXY_READ_TIMEOUT=300
NGINX_PROXY_CONNECT_TIMEOUT=300
NGINX_PROXY_SEND_TIMEOUT=300

# ============================================
# DOCKER & DEPLOYMENT
# ============================================
DOCKER_NETWORK=ibn_network
COMPOSE_PROJECT_NAME=ibn

# Health Check URLs
HEALTHCHECK_URL=http://localhost:8080/health
READINESS_URL=http://localhost:8080/ready

# ============================================
# FEATURE FLAGS
# ============================================
ENABLE_SWAGGER=false           # Disable in production
ENABLE_DEBUG_ENDPOINTS=false   # Disable in production
ENABLE_PROFILING=false         # Disable in production unless needed

# ============================================
# SECURITY HEADERS
# ============================================
ENABLE_SECURITY_HEADERS=true
HSTS_MAX_AGE=31536000
CONTENT_SECURITY_POLICY=default-src 'self'

# ============================================
# BACKUP & DISASTER RECOVERY
# ============================================
BACKUP_ENABLED=true
BACKUP_SCHEDULE=0 2 * * *  # Daily at 2 AM
BACKUP_RETENTION_DAYS=30

# ============================================
# NOTIFICATIONS (Optional)
# ============================================
# Slack webhook for critical alerts
SLACK_WEBHOOK_URL=
# Email for alerts
ALERT_EMAIL=admin@ibn.vn

# ============================================
# HASH VERIFICATION CONFIGURATION
# ============================================
# Secret salt for package hash generation (MUST be at least 32 characters)
# IMPORTANT: This secret MUST match the value used in:
#   - Chaincode (teaTraceCC)
#   - API Gateway
#   - Backend
# Changing this secret after deployment will invalidate all new package hashes
HASH_SECRET=ibn_hash_secret_2024_change_this_to_random_32_plus_chars_value
